<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teen Patti Game Login</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }
        #gameArea {
            margin-top: 20px;
            display: none; /* Hide game area initially */
        }
        #messages {
            border: 1px solid #ccc;
            height: 200px;
            overflow-y: scroll;
            margin-bottom: 20px;
            padding: 10px;
            background: white;
        }
        .input-field {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h1>Teen Patti Game Login</h1>

<div class="input-field">
    <label for="username">Username:</label>
    <input type="text" id="username" placeholder="Enter your Username" required />
</div>

<div class="input-field">
    <label for="password">Password:</label>
    <input type="password" id="password" placeholder="Enter your Password" required />
</div>

<button id="loginButton">Login</button>

<div id="gameArea">
    <h2>Game Area</h2>
    <div class="input-field">
        <label for="playerId">Player ID:</label>
        <input type="number" id="playerId" placeholder="Enter your Player ID" required />
    </div>

    <div class="input-field">
        <label for="gameId">Game ID:</label>
        <input type="number" id="gameId" placeholder="Enter Game ID" required />
    </div>

    <div class="input-field">
        <label for="action">Action:</label>
        <select id="action">
            <option value="JOIN">Join</option>
            <option value="BET">Bet</option>
            <option value="DEAL">Deal</option>
            <option value="FOLD">Fold</option>
            <option value="SHOW">Show</option>
        </select>
    </div>

    <div class="input-field" id="betField" style="display: none;">
        <label for="betAmount">Bet Amount:</label>
        <input type="number" id="betAmount" placeholder="Enter Bet Amount" />
    </div>

    <button id="sendButton">Send Action</button>

    <div id="messages"></div>
</div>

<script>
    var stompClient = null;
    var jwtToken = null;

<!--    document.getElementById('loginButton').addEventListener('click', function () {-->
<!--        const username = document.getElementById('username').value;-->
<!--        const password = document.getElementById('password').value;-->

<!--        // Login using username and password-->
<!--        fetch('api/auth-user/login-with-pass', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ username: username, password: password })-->
<!--        })-->
<!--        .then(response => {-->
<!--        console.log(response);-->

<!--            return response.json();-->
<!--        })-->
<!--        .then(data => {-->
<!--        console.log(data);-->

<!--            if (data.body) {-->
<!--                    console.log("Inside data.data check :");-->


<!--        jwtToken = data.body.replace(/"/g, ''); // Remove any quotes if present-->
<!--&lt;!&ndash;                jwtToken = data.body; // Store JWT token&ndash;&gt;-->
<!--                alert('Login successful!');-->
<!--                document.getElementById('gameArea').style.display = 'block'; // Show game area-->
<!--                connect(); // Connect to WebSocket-->
<!--            } else {-->
<!--                console.log("inside else");-->
<!--            }-->
<!--        })-->
<!--        .catch(error => {-->
<!--            console.error(error);-->
<!--            alert('Error: ' + error.message);-->
<!--        });-->
<!--    });-->

document.getElementById('loginButton').addEventListener('click', function () {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    // Login using username and password
    fetch('api/auth-user/login-with-pass', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: username, password: password })
    })
    .then(response => {
        return response.json(); // Parse JSON response
    })
    .then(data => {
        console.log('Response Data:', data); // Log response for debugging

        // Checking if token exists in response to confirm login success
        if (data && data.token) {
            jwtToken = data.token; // Store the token

            // Show success message and hide the "Login failed" message if any
            alert(data.message); // Show login successful message from response

            // Display the game area after login
            document.getElementById('gameArea').style.display = 'block';

            // Proceed with WebSocket connection
            connect();
        } else {
            // Handle the case where login fails and no token is returned
            alert('Login failed: Invalid credentials.');
        }
    })
    .catch(error => {
        // Handle any network or parsing errors
        console.error('Login error:', error); // Log error to console
        alert('Error during login: ' + error.message);
    });
});



function connect() {
    console.log('Attempting to connect...');

    // Ensure jwtToken is defined and has a valid value
    console.log('JWT Token: ', jwtToken);

    const socket = new SockJS('http://localhost:8081/join-game');

    stompClient = Stomp.over(socket);

    // Setting the Authorization header
    stompClient.connect(
        { 'Authorization': 'Bearer ' + jwtToken },
        function(frame) {
            console.log('Connected: ' + frame);
            // Subscribe to a topic
            stompClient.subscribe('/topic/gameUpdates', function(event) {
                showMessage(JSON.parse(event.body));
            });
        },
        function(error) {
            console.error('Connection error: ' + error);
            alert('Connection failed: ' + error);
        }
    );
}



    function sendAction() {
        const playerId = document.getElementById('playerId').value;
        const gameId = document.getElementById('gameId').value;
        const action = document.getElementById('action').value;
        const betAmount = action === "BET" ? document.getElementById('betAmount').value : 0;

        const playerAction = {
            playerId: parseInt(playerId),
            gameId: parseInt(gameId),
            action: action,
            betAmount: parseInt(betAmount)
        };

        stompClient.send("/app/gameAction", {}, JSON.stringify(playerAction));
    }

    function showMessage(message) {
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML += `<div>${JSON.stringify(message)}</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
    }

    document.getElementById('sendButton').addEventListener('click', function () {
        if (!stompClient) {
            connect();
        }
        sendAction();
    });

    document.getElementById('action').addEventListener('change', function () {
        document.getElementById('betField').style.display = this.value === "BET" ? 'block' : 'none';
    });
</script>
</body>
</html>
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Teen Patti Game Login</title>-->
<!--    <link rel="stylesheet" href="styles.css">-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            background-color: #f4f4f4;-->
<!--            padding: 20px;-->
<!--        }-->
<!--        #gameArea {-->
<!--            margin-top: 20px;-->
<!--            display: none; /* Hide game area initially */-->
<!--        }-->
<!--        #messages {-->
<!--            border: 1px solid #ccc;-->
<!--            height: 200px;-->
<!--            overflow-y: scroll;-->
<!--            margin-bottom: 20px;-->
<!--            padding: 10px;-->
<!--            background: white;-->
<!--        }-->
<!--        .input-field {-->
<!--            margin-bottom: 10px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<h1>Teen Patti Game Login</h1>-->

<!--<div class="input-field">-->
<!--    <label for="username">Username:</label>-->
<!--    <input type="text" id="username" placeholder="Enter your Username" required />-->
<!--</div>-->

<!--<div class="input-field">-->
<!--    <label for="password">Password:</label>-->
<!--    <input type="password" id="password" placeholder="Enter your Password" required />-->
<!--</div>-->

<!--<button id="loginButton">Login</button>-->

<!--<div id="gameArea">-->
<!--    <h2>Game Area</h2>-->
<!--    <div class="input-field">-->
<!--        <label for="playerId">Player ID:</label>-->
<!--        <input type="number" id="playerId" placeholder="Enter your Player ID" required />-->
<!--    </div>-->

<!--    <div class="input-field">-->
<!--        <label for="gameId">Game ID:</label>-->
<!--        <input type="number" id="gameId" placeholder="Enter Game ID" required />-->
<!--    </div>-->

<!--    <div class="input-field">-->
<!--        <label for="action">Action:</label>-->
<!--        <select id="action">-->
<!--            <option value="JOIN">Join</option>-->
<!--            <option value="BET">Bet</option>-->
<!--            <option value="DEAL">Deal</option>-->
<!--            <option value="FOLD">Fold</option>-->
<!--            <option value="SHOW">Show</option>-->
<!--        </select>-->
<!--    </div>-->

<!--    <div class="input-field" id="betField" style="display: none;">-->
<!--        <label for="betAmount">Bet Amount:</label>-->
<!--        <input type="number" id="betAmount" placeholder="Enter Bet Amount" />-->
<!--    </div>-->

<!--    <div class="input-field" id="blindField" style="display: none;">-->
<!--        <label for="isBlind">Playing Blind:</label>-->
<!--        <input type="checkbox" id="isBlind" />-->
<!--    </div>-->

<!--    <button id="sendButton">Send Action</button>-->

<!--    <div id="messages"></div>-->
<!--</div>-->

<!--<script>-->
<!--    var stompClient = null;-->
<!--    var jwtToken = null;-->

<!--&lt;!&ndash;    document.getElementById('loginButton').addEventListener('click', function () {&ndash;&gt;-->
<!--&lt;!&ndash;        const username = document.getElementById('username').value;&ndash;&gt;-->
<!--&lt;!&ndash;        const password = document.getElementById('password').value;&ndash;&gt;-->

<!--&lt;!&ndash;        // Login using username and password&ndash;&gt;-->
<!--&lt;!&ndash;        fetch('api/auth-user/login-with-pass', {&ndash;&gt;-->
<!--&lt;!&ndash;            method: 'POST',&ndash;&gt;-->
<!--&lt;!&ndash;            headers: { 'Content-Type': 'application/json' },&ndash;&gt;-->
<!--&lt;!&ndash;            body: JSON.stringify({ username: username, password: password })&ndash;&gt;-->
<!--&lt;!&ndash;        })&ndash;&gt;-->
<!--&lt;!&ndash;        .then(response => {&ndash;&gt;-->
<!--&lt;!&ndash;            return response.json();&ndash;&gt;-->
<!--&lt;!&ndash;        })&ndash;&gt;-->
<!--&lt;!&ndash;        .then(data => {&ndash;&gt;-->
<!--&lt;!&ndash;            if (data.body) {&ndash;&gt;-->
<!--&lt;!&ndash;                jwtToken = data.body.replace(/"/g, ''); // Remove any quotes if present&ndash;&gt;-->
<!--&lt;!&ndash;                alert('Login successful!');&ndash;&gt;-->
<!--&lt;!&ndash;                document.getElementById('gameArea').style.display = 'block'; // Show game area&ndash;&gt;-->
<!--&lt;!&ndash;                connect(); // Connect to WebSocket&ndash;&gt;-->
<!--&lt;!&ndash;            } else {&ndash;&gt;-->
<!--&lt;!&ndash;                alert('Login failed');&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;        })&ndash;&gt;-->
<!--&lt;!&ndash;        .catch(error => {&ndash;&gt;-->
<!--&lt;!&ndash;            console.error(error);&ndash;&gt;-->
<!--&lt;!&ndash;            alert('Error: ' + error.message);&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--document.getElementById('loginButton').addEventListener('click', function () {-->
<!--    const username = document.getElementById('username').value;-->
<!--    const password = document.getElementById('password').value;-->

<!--    // Login using username and password-->
<!--    fetch('api/auth-user/login-with-pass', {-->
<!--        method: 'POST',-->
<!--        headers: { 'Content-Type': 'application/json' },-->
<!--        body: JSON.stringify({ username: username, password: password })-->
<!--    })-->
<!--    .then(response => response.json()) // Parse JSON response-->
<!--    .then(data => {-->
<!--        console.log('Response Data:', data); // Log the response for debugging-->

<!--        // Check if the response contains a token (now checking the correct 'token' field)-->
<!--        if (data && data.token) {-->
<!--            jwtToken = data.token; // Store the token-->
<!--            alert(data.message); // Show the login success message from the response-->
<!--            document.getElementById('gameArea').style.display = 'block'; // Show the game area-->
<!--            connect(); // Connect to WebSocket-->
<!--        } else {-->
<!--            // If there's no token in the response, show the login failed message-->
<!--            alert('Login failed: Invalid credentials or response format.');-->
<!--        }-->
<!--    })-->
<!--    .catch(error => {-->
<!--        console.error('Login error:', error); // Log the error-->
<!--        alert('Error during login: ' + error.message);-->
<!--    });-->
<!--});-->

<!--    function connect() {-->
<!--        console.log('Attempting to connect...');-->

<!--        // Ensure jwtToken is defined and has a valid value-->
<!--        console.log('JWT Token: ', jwtToken);-->

<!--        const socket = new SockJS('http://localhost:8081/ws-game');-->

<!--        stompClient = Stomp.over(socket);-->

<!--        // Setting the Authorization header-->
<!--        stompClient.connect(-->
<!--            { 'Authorization': 'Bearer ' + jwtToken },-->
<!--            function(frame) {-->
<!--                console.log('Connected: ' + frame);-->
<!--                // Subscribe to a topic-->
<!--                stompClient.subscribe('/topic/gameUpdates', function(event) {-->
<!--                    showMessage(JSON.parse(event.body));-->
<!--                });-->
<!--            },-->
<!--            function(error) {-->
<!--                console.error('Connection error: ' + error);-->
<!--                alert('Connection failed: ' + error);-->
<!--            }-->
<!--        );-->
<!--    }-->

<!--   function sendAction() {-->
<!--    const playerId = document.getElementById('playerId').value;-->
<!--    const gameId = document.getElementById('gameId').value;-->
<!--    const action = document.getElementById('action').value;-->
<!--    const betAmount = action === "BET" ? document.getElementById('betAmount').value : 0;-->
<!--    const isBlind = document.getElementById('isBlind').checked; // For blind play-->

<!--    console.log('isBlind:', isBlind);  // Add this for debugging-->

<!--    const playerAction = {-->
<!--        playerId: parseInt(playerId),-->
<!--        gameId: parseInt(gameId),-->
<!--        action: action,-->
<!--        betAmount: parseInt(betAmount),-->
<!--        isBlind: isBlind-->
<!--    };-->

<!--    stompClient.send("/app/gameAction", {}, JSON.stringify(playerAction));-->

<!--    console.log("Action sent: ", playerAction); // Logging to console-->
<!--}-->


<!--    function showMessage(message) {-->
<!--        const messagesDiv = document.getElementById('messages');-->
<!--        messagesDiv.innerHTML += `<div>${JSON.stringify(message)}</div>`;-->
<!--        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom-->
<!--    }-->

<!--    document.getElementById('sendButton').addEventListener('click', function () {-->
<!--        if (!stompClient) {-->
<!--            connect();-->
<!--        }-->
<!--        sendAction();-->
<!--    });-->

<!--   document.getElementById('action').addEventListener('change', function () {-->
<!--    const isBetAction = this.value === "BET";-->
<!--    document.getElementById('betField').style.display = isBetAction ? 'block' : 'none';-->
<!--    document.getElementById('blindField').style.display = isBetAction ? 'block' : 'none';-->

<!--    // Reset the checkbox when the action changes to something other than BET-->
<!--    if (!isBetAction) {-->
<!--        document.getElementById('isBlind').checked = false; // Reset the checkbox-->
<!--    }-->
<!--});-->

<!--</script>-->
<!--</body>-->
<!--</html>-->
